{% extends 'base.html' %}
{% load product_filters %}
{% block title %}{{ product.name }} - E-Commerce{% endblock %}

{% block content %}
<div class="animate-fade-up">
    <!-- Breadcrumbs -->
    <nav class="flex mb-8 text-sm font-medium text-gray-500" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-2">
            <li><a href="/" class="hover:text-blue-600">Home</a></li>
            <li class="flex items-center space-x-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                <a href="{% url 'product_list_by_category' product.category.slug %}" class="hover:text-blue-600">{{
                    product.category.name }}</a>
            </li>
            <li class="flex items-center space-x-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                <span class="text-gray-900">{{ product.name }}</span>
            </li>
        </ol>
    </nav>

    <div class="flex flex-col md:flex-row gap-8 lg:gap-16 items-start">
        <!-- Product Image Section -->
        <div class="w-full md:w-1/2 lg:w-[45%] sticky md:top-28">
            <div class="glass p-4 rounded-3xl overflow-hidden shadow-2xl shadow-blue-500/5">
                <div
                    class="aspect-square bg-white rounded-2xl overflow-hidden relative group border border-gray-100/50">
                    {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.name }}"
                        class="w-full h-full object-contain p-8 group-hover:scale-110 transition-transform duration-700">
                    {% else %}
                    <div class="w-full h-full flex flex-col items-center justify-center text-gray-300">
                        <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                            </path>
                        </svg>
                        <span class="text-xs font-semibold uppercase tracking-widest">No Image Available</span>
                    </div>
                    {% endif %}

                    {% if product.discount_price %}
                    <span
                        class="absolute top-6 left-6 bg-red-500 text-white text-[10px] uppercase font-black tracking-tighter px-3 py-1 rounded-full shadow-lg z-10">Offer</span>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Product Info Section -->
        <div class="w-full md:w-1/2 lg:w-[55%] flex flex-col animate-fade-left">
            <div class="mb-8">
                <p class="text-[10px] font-black text-blue-600 uppercase tracking-[0.3em] mb-4">{{ product.category.name
                    }}</p>
                <h1 class="text-4xl sm:text-5xl font-black text-gray-900 leading-none tracking-tight mb-6">{{
                    product.name }}</h1>

                <div class="flex items-center gap-4 mb-6">
                    {% if product.discount_price %}
                    <span class="text-2xl font-extrabold text-gray-900">${{ product.discount_price }}</span>
                    <span class="text-lg font-medium text-gray-400 line-through">${{ product.price }}</span>
                    <span class="bg-green-100 text-green-700 text-[10px] font-bold px-2 py-1 rounded-md">Save ${{
                        product.price|subtract:product.discount_price|default:0 }}</span>
                    {% else %}
                    <span class="text-2xl font-extrabold text-gray-900">${{ product.price }}</span>
                    {% endif %}
                </div>

                <div class="prose prose-sm text-gray-600 mb-8 leading-relaxed max-w-none">
                    <p>{{ product.description }}</p>
                </div>

                <form action="{% url 'cart:cart_add' product.id %}" method="post" class="mt-auto space-y-4">
                    {% csrf_token %}
                    <div class="flex items-center gap-4 mb-6">
                        <div
                            class="flex items-center border border-gray-100 rounded-xl px-2 py-1 bg-white ring-1 ring-gray-200/50">
                            <input type="number" name="quantity" value="1" min="1" max="{{ product.stock }}"
                                class="w-12 text-center text-sm font-bold outline-none border-none">
                        </div>
                        <p
                            class="text-xs font-semibold {% if product.stock > 0 %}text-green-600{% else %}text-red-500{% endif %}">
                            {% if product.stock > 0 %}In Stock ({{ product.stock }}){% else %}Out of Stock{% endif %}
                        </p>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-3">
                        <button type="submit"
                            class="btn-premium flex-grow !rounded-xl !py-4 shadow-xl shadow-blue-500/10 text-sm flex items-center justify-center gap-2 active:scale-[0.98]">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z">
                                </path>
                            </svg>
                            Add to Cart
                        </button>
                        <button
                            class="bg-gray-900 text-white font-bold text-sm px-8 py-4 rounded-xl hover:bg-black transition-all shadow-xl shadow-black/10 active:scale-[0.98]">
                            Buy Now
                        </button>
                        <button
                            class="p-4 rounded-xl border border-gray-100 bg-white hover:bg-gray-50 transition active:scale-95 group ring-1 ring-gray-200/50">
                            <svg class="w-5 h-5 text-gray-300 group-hover:text-red-500 transition-colors" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                                </path>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Related Products -->
    {% if related_products %}
    <div class="mt-24">
        <h3 class="text-2xl font-bold text-gray-900 mb-8">You May Also Like</h3>
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-6">
            {% for rp in related_products %}
            <div class="card-premium group hover-lift ring-1 ring-black/5">
                <a href="{{ rp.get_absolute_url }}">
                    <div class="relative h-48 bg-gray-50 overflow-hidden">
                        {% if rp.image %}
                        <img src="{{ rp.image.url }}" alt="{{ rp.name }}"
                            class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                        {% endif %}
                    </div>
                    <div class="p-4">
                        <h4 class="font-bold text-sm text-gray-900 mb-1 truncate">{{ rp.name }}</h4>
                        <p class="text-lg font-extrabold text-gray-900">${{ rp.price }}</p>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}